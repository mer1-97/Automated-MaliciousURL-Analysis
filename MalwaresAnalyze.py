#!python3
#-*- coding: utf-8 -*-

import json
import requests
from os import path

class Malware:
    def __init__(self):
        '''input your Malwares.com API Key'''
        self.api_key = ''
        self.headers = {
            'User-Agent' : 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36',
            'Content-Type' : 'application/x-www-form-urlencoded' 
        }
        self.response = None

    def url_analyze_info(self, url):
        '''
        result_mal_count : 악성으로 판단한 백신 엔진 수
        result_scan_date : Malwares.com에 가장 최근에 질의한 날짜      
        result_code : 응답 코드 
        result_msg : 응답 코드 설명
        '''
        def normal_result_code(res_code):
            result_code = int(res_code)
            if result_code // 2 == 0:
                return True

        params = {
            'api_key' : self.api_key,
            'url' : url
        }

        print('Search URL : {}'.format(url))
        #print('Set API Key : {}'.format(self.api_key))
        self.response = requests.post('https://public.api.malwares.com/v3/url/info', headers=self.headers, data=params)
        res_json = self.response.json()

        result_mal_count = ''
        result_scan_date = ''
        result_code = res_json['result_code']
        result_msg = res_json['result_msg']

        if normal_result_code(result_code):
            result_mal_count = res_json['virustotal']['positives']
            result_scan_date = res_json['virustotal']['scan_date']

        return result_mal_count, result_scan_date, result_code, result_msg
